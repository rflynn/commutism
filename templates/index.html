<!doctype html>
<html>
<head>
<meta charset="utf-8">
<style>

body {
    font: 11px/1.0 "Helvetica Neue",Helvetica,Arial,sans-serif;
    margin: 10px 0 0 0;
}

img.icon {
    height: 32px;
    width: 32px;
}

</style>
</head>
<body>

<div id="content">

    <h1 id="loc"></h1>
    <h1 id="errmsg" style="color:red"></h1>

</div>

<script>

function positionCallback(pos)
{
    var ts = pos.timestamp;
    var coords = pos.coords;
    var lat = coords.latitude;
    var long_ = coords.longitude;
    var acc = coords.accuracy;
    var speed = coords.speed;
    console.log('track', ts, coords, lat, long_, acc);
    document.getElementById('loc').innerText = '' + lat + ', ' + long_;
    document.getElementById('errmsg').innerText = ''; // reset
    var req = new XMLHttpRequest();
    var url = ('http://commutism.com:80/api/v0/track/me'
                + '?lat=' + lat
                + '&long=' + long_
                + '&acc=' + acc
                + '&speed=' + speed
               );

    // TODO: on failure (we're on the subway; start caching data clientside?)

    req.open('GET', url, true);
    req.onreadystatechange = function () {
        switch (req.readyState) {
        case 4:
            switch (req.status) {
            case 200:
                console.log('done', req);
                break;
            default:
                console.log('error', req);
                break;
            }
            break;
        default:
            //console.log('readyState', req.readyState, req);
            break;
        }
    }
    req.send();
}

if (navigator && navigator.geolocation) {
    console.log('tracking...');
    navigator.geolocation.watchPosition(positionCallback,
                                        function(e){
                                            document.getElementById('errmsg').innerText = e;
                                        },
                                        {
                                            desiredAccuracy: 0,
                                            enableHighAccuracy: true,
                                            frequency: 60 * 1000,
                                            maximumAge: 0,
                                            timeout: 5000
                                        });
}

</script>

<div>

    <table border="1">
        <tr>
            <th>Time<br>(mins)
            <th>Cost<br>($)
            <th colspan="3">Route
        <tr>
            <td>90
            <td rowspan="6">$13
            <td><img src="../data/image/icon/nycsubway/4.png" class="icon">
            <td rowspan="9"><img src="../data/image/icon/train.png" class="icon"><br>65 mins
            <td rowspan="9">
                <img src="../data/image/icon/walking.png" class="icon"><br>7 mins
                <div>
                    <img src="../data/image/icon/taxi.png" class="icon"><br>
                    4 mins
                 </div>

        <tr>
            <td>97
            <td><img src="../data/image/icon/nycsubway/R.png" class="icon">
                <img src="../data/image/icon/nycsubway/6.png" class="icon">

        <tr>
            <td>110
            <td><img src="../data/image/icon/nycsubway/R.png" class="icon">
                <img src="../data/image/icon/nycsubway/S.png" class="icon">

        <tr>
            <td>110
            <td><img src="../data/image/icon/nycsubway/1.png" class="icon">
                <img src="../data/image/icon/nycsubway/S.png" class="icon">

        <tr>
            <td>110
            <td><img src="../data/image/icon/walking.png" class="icon">
                <img src="../data/image/icon/nycsubway/A.png" class="icon">
                <img src="../data/image/icon/bus.png" class="icon" title="M60">

        <tr>
            <td>110
            <td><img src="../data/image/icon/nycsubway/1.png" class="icon">
                <img src="../data/image/icon/nycsubway/2.png" class="icon">
                <img src="../data/image/icon/bus.png" class="icon">

        <tr>
            <td>90
            <td>$33
            <td><img src="../data/image/icon/taxi.png" class="icon"> $20

        <tr>
            <td>130
            <td rowspan="2">$13
            <td><img src="../data/image/icon/nycsubway/J.png" class="icon">
                <img src="../data/image/icon/nycsubway/A.png" class="icon">
                <img src="../data/image/icon/walking.png" class="icon">
                <img src="../data/image/icon/nycsubway/S.png" class="icon">

        <tr>
            <td>135
            <td><img src="../data/image/icon/nycsubway/J.png" class="icon">
                <img src="../data/image/icon/nycsubway/A.png" class="icon">
                <img src="../data/image/icon/nycsubway/G.png" class="icon">
                <img src="../data/image/icon/nycsubway/7.png" class="icon">

        <tr>
            <td>120
            <td>$50
            <td colspan="3"><img src="../data/image/icon/car.png" class="icon">

        <tr>
            <td>110
            <td>$22-27
            <td><img src="../data/image/icon/bicycle.png" class="icon"> 30 mins
            <td rowspan="2"><img src="../data/image/icon/train.png" class="icon"><br>65 mins
            <td rowspan="2">
                <img src="../data/image/icon/walking.png" class="icon"><br>7 mins
                <div>
                    <img src="../data/image/icon/taxi.png" class="icon"><br>
                    4 mins
                 </div>

        <tr>
            <td>150
            <td>$11-16
            <td><img src="../data/image/icon/walking.png" class="icon"> 80 mins

    </table>

</div>

</body>
</html>
